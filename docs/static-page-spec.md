# SUMM 静态页面展示规范

本文档描述 SUMM 系统中有效文档的目录结构和数据格式，用于指导开发展示这些信息的静态页面。

---

## 1. 目录结构

```
SUMM 项目根目录/
├── summ_plan.md              # 任务看板
├── CLAUDE.md                 # 系统配置（一般不展示）
├── .summ/
│   ├── active/               # 工作台（当前执行中的任务）
│   │   ├── task.md          # 当前任务详情
│   │   ├── session.txt      # Worker Session ID
│   │   ├── journal.md       # 执行日志（可选）
│   │   └── handoff.md       # 交付报告（可选）
│   ├── archive/              # 历史任务归档
│   │   ├── YYYYMMDD_T_<id>_task.md      # 任务说明
│   │   ├── YYYYMMDD_T_<id>_journal.md   # 执行日志
│   │   └── YYYYMMDD_T_<id>_handoff.md   # 交付报告
│   └── daily/                # 每日流水账
│       └── YYYY-MM.md       # 按月归档的每日摘要
```

---

## 2. 数据格式

### 2.1 任务看板 (summ_plan.md)

**路径**: `summ_plan.md`

**格式**:

```markdown
# SUMM 任务看板

## 待办

- [ ] T_20260203_120000 - 实现用户登录功能
- [ ] T_20260203_123000 - 编写 API 文档

## 进行中

- [Working] T_20260203_130000 - 修复页面样式问题

## 已完成

- [x] T_20260203_100000 - 搭建项目框架
- [x] T_20260203_110000 - 配置开发环境

## 失败

- [Failed] T_20260202_180000 - 尝试集成第三方服务
```

**数据模型**:

| 字段 | 说明 |
|------|------|
| 状态 | `[ ]` 待办 / `[Working]` 进行中 / `[x]` 已完成 / `[Failed]` 失败 |
| 任务ID | `T_YYYYMMDD_HHMMSS` 格式 |
| 描述 | 任务简要描述 |

---

### 2.2 任务详情 (task.md)

**路径**: `.summ/active/task.md`

**格式**:

```markdown
# 任务 T_20260203_130000

**描述**: 实现用户登录功能，包括邮箱登录和第三方 OAuth 登录

**创建时间**: 2026-02-03T13:00:00+08:00

**工作空间**: /tmp/summ-workspace-T_20260203_130000/

**任务ID**: T_20260203_130000
```

**数据模型**:

| 字段 | 类型 | 说明 |
|------|------|------|
| 任务ID | string | `T_YYYYMMDD_HHMMSS` |
| 描述 | string | 完整任务描述 |
| 创建时间 | datetime | ISO 8601 格式 |
| 工作空间 | path | Worker 执行目录 |

---

### 2.3 执行日志 (journal.md)

**路径**: `.summ/active/journal.md` 或 `.summ/archive/YYYYMMDD_T_<id>_journal.md`

**格式**:

```markdown
# 任务执行日志 T_20260203_130000

## 2026-02-03 13:00:00 - 任务开始

收到任务：实现用户登录功能

## 2026-02-03 13:05:00 - 技术方案确定

采用 JWT Token 认证方案，后端使用 Node.js + Express

## 2026-02-03 13:30:00 - 数据库设计

创建 users 表，包含 id, email, password_hash, created_at 字段

## 2026-02-03 14:00:00 - API 开发完成

实现 POST /api/auth/login 和 POST /api/auth/register

## 2026-02-03 14:30:00 - 任务完成

所有功能已实现并测试通过
```

**数据模型**: 自由文本，按时间顺序记录关键决策

---

### 2.4 交付报告 (handoff.md)

**路径**: `.summ/active/handoff.md` 或 `.summ/archive/YYYYMMDD_T_<id>_handoff.md`

**格式**:

```markdown
# 任务交付 T_20260203_130000

**状态**: Success

**完成时间**: 2026-02-03T14:30:00+08:00

## 结果描述

成功实现用户登录功能，包括：
- 邮箱密码登录
- Google OAuth 登录
- JWT Token 认证
- 密码加密存储

## 修改文件

- src/api/auth/login.js
- src/api/auth/register.js
- src/models/user.js
- src/middleware/auth.js
- src/config/jwt.js

## 备注

所有功能已通过单元测试，覆盖率 95%
```

**数据模型**:

| 字段 | 类型 | 说明 |
|------|------|------|
| 状态 | enum | Success / Failed |
| 完成时间 | datetime | ISO 8601 格式 |
| 结果描述 | string | 任务执行结果 |
| 修改文件 | list | 修改的文件路径列表 |
| 备注 | string | 其他说明信息 |

---

### 2.5 Session 信息 (session.txt)

**路径**: `.summ/active/session.txt`

**格式**: 纯文本，存储 SUMM-Daemon 返回的 Session ID

```
worker-T_20260203_130000_abc123
```

---

### 2.6 每日流水 (YYYY-MM.md)

**路径**: `.summ/daily/YYYY-MM.md`

**格式**:

```markdown
# 2026年2月 每日流水

## 2026-02-03

### 完成任务
- T_20260203_100000 - 搭建项目框架
- T_20260203_110000 - 配置开发环境
- T_20260203_130000 - 实现用户登录功能

### 进行中
- T_20260203_150000 - 编写 API 文档

## 2026-02-02

### 完成任务
- T_20260202_090000 - 需求评审

### 失败
- T_20260202_180000 - 尝试集成第三方服务（API 不可用）
```

---

## 3. 页面展示需求

### 3.1 任务看板页面

**路由**: `/` 或 `/board`

**展示内容**:
- 四列看板：待办、进行中、已完成、失败
- 每个任务卡片显示：
  - 任务 ID
  - 任务描述摘要
  - 创建时间
- 点击卡片查看详情

**交互**:
- 拖拽任务卡片切换状态（可选）
- 点击卡片展开任务详情

---

### 3.2 任务详情页面

**路由**: `/task/:taskId`

**展示内容**:

| 区域 | 内容 |
|------|------|
| 基本信息 | 任务 ID、状态、创建时间 |
| 任务描述 | 完整任务描述 |
| 工作空间 | 工作空间路径 |
| 执行日志 | journal.md 内容（如有） |
| 交付报告 | handoff.md 内容（如有） |
| 修改文件 | 文件列表（可链接到代码仓库） |

**交互**:
- 返回看板按钮
- 查看归档文件（如已归档）

---

### 3.3 历史任务页面

**路由**: `/history`

**展示内容**:
- 按日期分组的历史任务列表
- 每个任务显示：
  - 任务 ID
  - 状态（成功/失败）
  - 完成时间
  - 简要描述

**筛选器**:
- 日期范围
- 状态（全部/成功/失败）
- 搜索关键词

---

### 3.4 每日流水页面

**路由**: `/daily`

**展示内容**:
- 日历视图或时间线视图
- 每日任务摘要：
  - 完成任务数
  - 失败任务数
  - 任务列表

---

### 3.5 当前状态页面

**路由**: `/status`

**展示内容**:

| 区域 | 数据源 |
|------|--------|
| 当前任务 | `.summ/active/task.md` |
| Worker 状态 | `summ list` 命令 |
| 执行日志 | `.summ/active/journal.md` |
| Session ID | `.summ/active/session.txt` |

---

## 4. API 规范（供静态页面调用）

静态页面需要能够读取以下数据：

### 4.1 读取任务看板

```
GET /api/board
```

**响应**:
```json
{
  "todo": [
    { "id": "T_20260203_120000", "description": "实现用户登录", "createdAt": "2026-02-03T12:00:00+08:00" }
  ],
  "working": [
    { "id": "T_20260203_130000", "description": "修复页面样式", "createdAt": "2026-02-03T13:00:00+08:00" }
  ],
  "done": [
    { "id": "T_20260203_100000", "description": "搭建项目框架", "createdAt": "2026-02-03T10:00:00+08:00", "completedAt": "2026-02-03T11:30:00+08:00" }
  ],
  "failed": [
    { "id": "T_20260202_180000", "description": "集成第三方服务", "createdAt": "2026-02-02T18:00:00+08:00", "failedAt": "2026-02-02T19:00:00+08:00" }
  ]
}
```

### 4.2 读取任务详情

```
GET /api/task/:taskId
```

**响应**:
```json
{
  "id": "T_20260203_130000",
  "description": "实现用户登录功能",
  "createdAt": "2026-02-03T13:00:00+08:00",
  "workspace": "/tmp/summ-workspace-T_20260203_130000/",
  "status": "working",
  "journal": "# 执行日志\n...",
  "handoff": "# 交付报告\n...",
  "modifiedFiles": ["src/api/auth/login.js", "src/api/auth/register.js"]
}
```

### 4.3 读取历史任务

```
GET /api/history?start=2026-02-01&end=2026-02-28&status=success
```

### 4.4 读取每日流水

```
GET /api/daily?month=2026-02
```

### 4.5 读取当前状态

```
GET /api/status
```

**响应**:
```json
{
  "currentTask": {
    "id": "T_20260203_130000",
    "description": "修复页面样式问题",
    "createdAt": "2026-02-03T13:00:00+08:00"
  },
  "workers": [
    { "id": "worker-T_20260203_130000_abc123", "status": "running" }
  ]
}
```

---

## 5. 实现建议

### 5.1 后端服务

由于静态页面无法直接读取文件系统，需要实现一个轻量级后端服务：

1. **文件监听**: 监听 `summ_plan.md` 和 `.summ/` 目录变化
2. **解析 Markdown**: 解析任务看板、任务详情、日志等文件
3. **REST API**: 提供上述 API 接口
4. **WebSocket (可选)**: 实时推送任务状态变化

### 5.2 技术选型建议

| 组件 | 推荐技术 |
|------|----------|
| 后端 | Node.js + Express / Python + FastAPI |
| 前端 | React + TypeScript / Vue + TypeScript |
| 样式 | Tailwind CSS / shadcn/ui |
| Markdown 解析 | remark / unified |
| 文件监听 | chokidar / watchdog |

### 5.3 部署方案

1. **开发模式**: 后端服务监听本地 SUMM 项目目录
2. **生产模式**:
   - 后端服务部署在服务器
   - 定期同步 SUMM 项目到服务器
   - 或使用 Git webhook 触发更新

---

## 6. 设计参考

### 6.1 任务卡片样式

```markdown
┌─────────────────────────────────────┐
│ T_20260203_130000          Working  │
│ 实现用户登录功能                    │
│                                     │
│ 2026-02-03 13:00                   │
└─────────────────────────────────────┘
```

### 6.2 任务详情页面布局

```
┌─────────────────────────────────────────────────┐
│  ← 返回看板    任务 T_20260203_130000    [编辑]  │
├─────────────────────────────────────────────────┤
│                                                  │
│  状态: [进行中]    创建时间: 2026-02-03 13:00   │
│                                                  │
│  任务描述                                       │
│  ┌─────────────────────────────────────────┐    │
│  │ 实现用户登录功能，包括邮箱登录和...     │    │
│  └─────────────────────────────────────────┘    │
│                                                  │
│  执行日志                          [展开/折叠]   │
│  ┌─────────────────────────────────────────┐    │
│  │ ## 13:00:00 - 任务开始                 │    │
│  │ ## 13:05:00 - 技术方案确定             │    │
│  └─────────────────────────────────────────┘    │
│                                                  │
│  修改文件 (4)                                   │
│  • src/api/auth/login.js                        │
│  • src/api/auth/register.js                     │
│                                                  │
└─────────────────────────────────────────────────┘
```
